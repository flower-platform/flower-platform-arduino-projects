<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="http://bootswatch.com/paper/bootstrap.min.css">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<script>
var url = "http://192.168.100.253:80/";

var bindingManager = {

	// Initialize bound object
	data : {
		temperature : 25,
		humidity : 25
	},

	// Listeners map
	listeners : {},

	// Register a listener
	addListener : function(property, listener) {
		var list = this.listeners[property];
		if (typeof list === "undefined") {
			// init
			list = [];
			this.listeners[property] = list;
		}
		list.push(listener);
	},

	// Set the value and notify listeners
	set : function(property, value) {
		if (this.data[property] !== value) {
			// only if different value
			this.data[property] = value;

			var list = this.listeners[property];
			if (typeof list !== "undefined" && list !== null) {
				// notify listeners
				for (var i = 0; i < list.length; i++) {
					list[i]();
				}
			}
		}
	}

};

var addTextListener = function(id, property, options) {
	var listener = function() {
		var elt = $("#" + id);
		var value = bindingManager.data[property];
		if (typeof options !== "undefined") {
			value = options[value];
		}
		elt.text(value);
	};
	bindingManager.addListener(property, listener);
	listener();
};

var addClassListener = function(id, property, options) {
	var listener = function() {
		var elt = $("#" + id);
		var value = bindingManager.data[property];
		for (var key in options) {
			var cls = options[key];
			if (key == value) {
				elt.addClass(cls);
			} else {
				elt.removeClass(cls);
			}
		}
	}
	bindingManager.addListener(property, listener);
	listener();
};

var invoke = function(path) {
	$.get(url + path, function(data) {
		for (var key in data) {
			bindingManager.set(key, data[key]);
		};
	});
};

var refresh = function() {
	bindingManager.set("temperature", (bindingManager.data.temperature - 1) % 50);
	bindingManager.set("humidity", (bindingManager.data.humidity + 1) % 50);
	invoke("getUpdates");
};

setInterval(function() {
	refresh();
}, 1000);
</script>
</head>

<body>
<br/>
<div class="container-fluid lead">
	<div class="row">
		<div class="col-md-3">
			<div class="panel panel-primary text-center" id="bedroom">
				<div class="panel-heading">Bedroom</div>
				
				<div class="panel-body">
			
					<div class="row">
						<div class="col-xs-6">
							<div>Temperature</div>
							<div>
								<span id="bedroom-temperature"></span> &#176;C
								<script>addTextListener("bedroom-temperature", "temperature")</script>
							</div>
						</div>
						<div class="col-xs-6">
							<div>Humidity</div>
							<div>
								<span id="bedroom-humidity"></span> %RH
								<script>addTextListener("bedroom-humidity", "humidity")</script>
							</div>
						</div>
					</div>
					<div>Light</div>
					<div>
						<span id="bedroom-light"></span>
						<script>addTextListener("bedroom-light", "relay1")</script>
					</div>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('relay1Toggle')">
						<span class="glyphicon glyphicon-flash"></span> LIGHT
					</button>
			
				</div>
			</div>
		</div>
		<div class="col-md-3">
			<div class="panel panel-primary text-center" id="bathroom">
				<div class="panel-heading">Bathroom</div>
				
				<div class="panel-body">
			
					<div class="row">
						<div class="col-xs-6">
							<div>Temperature</div>
							<div>
								<span id="bathroom-temperature"></span> &#176;C
								<script>addTextListener("bathroom-temperature", "temperature")</script>
							</div>
						</div>
						<div class="col-xs-6">
							<div>Humidity</div>
							<div>
								<span id="bathroom-humidity"></span> %RH
								<script>addTextListener("bathroom-humidity", "humidity")</script>
							</div>
						</div>
					</div>
					<div>Light</div>
					<div>
						<span id="bathroom-light"></span>
						<script>addTextListener("bathroom-light", "relay1")</script>
					</div>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('relay1Toggle')">
						<span class="glyphicon glyphicon-flash"></span> LIGHT
					</button>
			
				</div>
			</div>
		</div>
		<div class="col-md-3">
			<div class="panel panel-primary text-center" id="kitchen">
				<div class="panel-heading">Kitchen</div>
				
				<div class="panel-body">
			
					<div class="row">
						<div class="col-xs-6">
							<div>Temperature</div>
							<div>
								<span id="kitchen-temperature"></span> &#176;C
								<script>addTextListener("kitchen-temperature", "temperature")</script>
							</div>
						</div>
						<div class="col-xs-6">
							<div>Humidity</div>
							<div>
								<span id="kitchen-humidity"></span> %RH
								<script>addTextListener("kitchen-humidity", "humidity")</script>
							</div>
						</div>
					</div>
					<div>Light</div>
					<div>
						<span id="kitchen-light"></span>
						<script>addTextListener("kitchen-light", "relay1")</script>
					</div>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('relay1Toggle')">
						<span class="glyphicon glyphicon-flash"></span> LIGHT
					</button>
			
				</div>
			</div>
		</div>
		<div class="col-md-3">
			<div class="panel panel-primary text-center" id="dining-room">
				<div class="panel-heading">Dining Room</div>
				
				<div class="panel-body">
			
					<div class="row">
						<div class="col-xs-6">
							<div>Temperature</div>
							<div>
								<span id="dining-room-temperature"></span> &#176;C
								<script>addTextListener("dining-room-temperature", "temperature")</script>
							</div>
						</div>
						<div class="col-xs-6">
							<div>Humidity</div>
							<div>
								<span id="dining-room-humidity"></span> %RH
								<script>addTextListener("dining-room-humidity", "humidity")</script>
							</div>
						</div>
					</div>
					<div>Light</div>
					<div>
						<span id="dining-room-light"></span>
						<script>addTextListener("dining-room-light", "relay1")</script>
					</div>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('relay1Toggle')">
						<span class="glyphicon glyphicon-flash"></span> LIGHT
					</button>
			
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Blinker releu</div>
				
				<div class="panel-body">
			
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('timer1Start')">
						<span class="glyphicon glyphicon-play"></span> START
					</button>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('timer1Stop')">
						<span class="glyphicon glyphicon-stop"></span> STOP
					</button>
			
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Panel with text</div>
				
				<div class="panel-body">
			
					<div>Salut. Acesta este un text.</div>
					<div>Salut. Acesta este un text.</div>
			
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Blinker led albastru</div>
				
				<div class="panel-body">
			
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('ledBlueBlinkStart')">
						<span class="glyphicon glyphicon-play"></span> START
					</button>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('ledBlueBlinkStop')">
						<span class="glyphicon glyphicon-stop"></span> STOP
					</button>
			
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Blinker releu</div>
				
				<div class="panel-body">
			
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('timer1Start')">
						<span class="glyphicon glyphicon-play"></span> START
					</button>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('timer1Stop')">
						<span class="glyphicon glyphicon-stop"></span> STOP
					</button>
			
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Panel with text</div>
				
				<div class="panel-body">
			
					<div>Salut. Acesta este un text.</div>
					<div>Salut. Acesta este un text.</div>
			
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Blinker led albastru</div>
				
				<div class="panel-body">
			
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('ledBlueBlinkStart')">
						<span class="glyphicon glyphicon-play"></span> START
					</button>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('ledBlueBlinkStop')">
						<span class="glyphicon glyphicon-stop"></span> STOP
					</button>
			
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<div class="panel panel-primary text-center">
				<div class="panel-heading">Test Dan</div>
				
				<div class="panel-body">
			
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('ledOn1Sec')">
						<span class="glyphicon glyphicon-play"></span> Led on 1 sec
					</button>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('releuDanOn')">
						<span class="glyphicon glyphicon-stop"></span> Releu ON
					</button>
					<button class="btn btn-block btn-lg" type="button" onclick="invoke('releuDanOff')">
						<span class="glyphicon glyphicon-play"></span> Releu OFF
					</button>
			
				</div>
			</div>
		</div>
	</div>

</div>

</body>